# 약안 생성 프롬프트 점검 요약

## 1. 연간지도_계획.json과의 연동

| 항목 | 상태 | 설명 |
|------|------|------|
| **교과·학년 조회** | ✅ | `getChasiActivity`에서 `p.교과 === subject && p.학년 === gradeStr`로 항목 조회. 1~6학년, 국어/수학/과학/도덕/사회/미술/음악/체육/실과/통합 모두 연간지도_계획에 있으면 정상 동작. |
| **단원 매칭** | ✅ | `단원명 === unitName` 또는 `단원번호 === unitName` 또는 `단원명.includes(unitName)` 사용. 프론트는 `<option value="단원명">`으로 전달하므로 단원명 일치. 통합의 "나·자연·마을·세계", 국어 "1. 만나서 반가워요!" 등 모두 매칭 가능. |
| **차시 범위** | ✅ | `차시` 필드 "1", "1~2", "13~15" 형식을 정규식 `^(\d+)(?:~(\d+))?$`로 파싱. 해당 차시가 속한 구간의 **가장 좁은 범위**를 선택해 `내용` 반환. |
| **chasiBlock 주입** | ✅ | 찾은 `차시별_주요_활동.내용`을 `"N차시 주요 학습 내용 및 활동: {내용}"` 형태로 프롬프트에 삽입. AI가 이 문장을 학습 주제·목표·전개 활동에 그대로 반영하도록 지시함. |

## 2. 프롬프트 내용 정합성

- **[이 차시의 핵심]** 블록: 연간지도 계획의 "차시별 주요 학습 내용 및 활동" 문장을 **축약·변형·대체 금지**로 명시.
- **학습 주제(topic)·학습 목표(objective)**: 위 "주요 학습 내용 및 활동"에서 **그대로 뽑아** 사용하도록 2번 항목으로 강조.
- **전개 활동**: "주요 학습 내용 및 활동"을 **구체화한** 도입·전개·정리로 설계하도록 6번에 명시.
- **요약 문장**: objective·topic·전개 활동이 모두 [이 차시의 핵심]과 **일치**해야 한다고 마지막에 재강조.

## 3. 적용한 수정 사항

1. **차시 내용 미조회 시 안내 문구**  
   연간지도에서 해당 단원·차시를 찾지 못한 경우, `chasiBlock`을 비우지 않고 아래 문구를 넣도록 변경함.  
   - *"연간지도 계획에서 이 단원·차시에 해당하는 '차시별 주요 활동'을 찾지 못했습니다. 선택한 단원(…)과 N차시에 맞게, 해당 교과 성취기준과 연계하여 학습 주제·목표와 활동을 작성하세요."*

2. **수업 설계 흐름 문단 정리**  
   - "[이 차시의 핵심]" 블록이 곧 이 차시 학습 내용임을 1번에 명시.  
   - topic·objective를 "주요 학습 내용 및 활동"에서 그대로 뽑아 쓰도록 2번 유지.  
   - 탐구 질문·수업의도·평가계획·40분 구조(도입+전개+정리) 순서를 4~6번으로 정리.  
   - 마지막에 "objective·topic·전개 활동은 모두 [이 차시의 핵심]과 일치" 요약 추가.

## 4. 확인 권장 사항

- **성취기준 JSON**: `2022개정교육과정 성취기준 및 해설.json`에 **통합** 교과 항목이 있으면 통합 1·2학년 약안 생성 시 성취기준이 채워짐. 없으면 성취기준 블록이 비거나 fallback만 사용될 수 있음.
- **핵심아이디어**: `핵심아이디어.txt`가 JSON 배열이어야 하며, `getCoreIdeaFromFile`에서 교과·영역으로 조회함. 형식이 다르면 빈 문자열 반환 후 AI로 생성 시도.

## 5. 결론

- 연간지도_계획의 **단원목록**과 **차시별_주요_활동**이 프롬프트와 일치하도록 사용되고 있음.
- "주요 학습 내용 및 활동"을 **그대로 반영**하라는 지시가 단계별·요약으로 명확히 들어가 있어, 교과·학년·단원·차시에 맞는 약안이 나오도록 정합성이 맞춰져 있음.
- 차시를 찾지 못하는 경우에도, 단원·차시와 성취기준을 활용해 작성하라는 **안내 문구**가 들어가도록 보완함.
